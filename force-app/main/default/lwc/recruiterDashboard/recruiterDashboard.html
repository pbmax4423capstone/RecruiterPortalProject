<template>
  <div class={dashboardContainerClass}>
    <!-- Top Greeting Banner -->
    <div class="greeting-banner">
      <h2 class="greeting-text">{timeBasedGreeting}, {computedUserFirstName}! 👋</h2>
    </div>

    <!-- Branded Header -->
    <div class="branded-header">
      <div class="slds-page-header__row">
        <div class="slds-page-header__col-title">
          <div class="slds-media">
            <div class="slds-media__figure">
              <div class="company-logo">
                <lightning-icon icon-name="standard:lead" alternative-text="Company Logo" size="large" class="logo-icon"></lightning-icon>
              </div>
            </div>
            <div class="slds-media__body">
              <div class="slds-page-header__name">
                <div class="slds-page-header__name-title">
                  <h1>
                    <span class="slds-page-header__title slds-truncate" title="Recruiter Dashboard">Capstone Partners - Recruiter Portal</span>
                  </h1>
                </div>
              </div>
              <!-- Welcome Message - moved below title -->
              <div class="welcome-message">
                <span class="slds-text-heading_small slds-text-color_inverse">{timeBasedGreeting}, {computedUserFirstName}!</span>
              </div>
            </div>
          </div>
        </div>
        <div class="slds-page-header__col-actions">
          <!-- Action Buttons Row -->
          <div class="action-buttons-container">
            <!-- Dark Mode Toggle -->
            <lightning-button-icon
              icon-name={darkModeIcon}
              alternative-text="Toggle Dark Mode"
              title="Toggle Dark Mode"
              onclick={toggleDarkMode}
              variant="border-filled"
              class="dark-mode-toggle-nav">
            </lightning-button-icon>
            <lightning-button-group>
              <lightning-button 
                variant="brand" 
                label="Create Ticket" 
                icon-name="utility:add"
                onclick={openCreateTicketModal}
                class="action-button">
              </lightning-button>
              <lightning-button 
                variant="brand" 
                label="Schedule Call" 
                icon-name="utility:phone_portrait"
                onclick={openScheduleCallModal}
                class="action-button">
              </lightning-button>
              <lightning-button 
                variant="brand" 
                label="Reschedule Calls" 
                icon-name="utility:event"
                onclick={openRescheduleCallsModal}
                class="action-button">
              </lightning-button>
              <lightning-button 
                variant="brand" 
                label="Create New Candidate" 
                icon-name="utility:add_contact"
                onclick={openCreateNewCandidateFlow}
                class="action-button">
              </lightning-button>
              <lightning-button 
                variant="brand" 
                label="Schedule Interview" 
                icon-name="utility:event"
                onclick={openScheduleInterviewModal}
                class="action-button">
              </lightning-button>
              <lightning-button 
                variant="brand" 
                label="Submit Feedback" 
                icon-name="utility:feedback"
                onclick={openFeedbackModal}
                class="action-button">
              </lightning-button>

            </lightning-button-group>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard Content -->
    <div class="slds-grid slds-wrap slds-gutters slds-p-top_large">
      
      <!-- Call Management Lists -->
      <div class="slds-col slds-size_12-of-12 slds-p-bottom_medium">
        <div class="slds-grid slds-wrap slds-gutters">
          
          <!-- Scheduled Calls List -->
          <div class="slds-col slds-size_6-of-12">
            <lightning-card title="📅 Scheduled Calls" icon-name="utility:clock">
              <div slot="actions">
                <lightning-button-menu 
                  alternative-text="Show menu" 
                  icon-size="x-small" 
                  menu-alignment="right">
                  <lightning-menu-item value="refresh" label="Refresh" onclick={loadScheduledCalls}></lightning-menu-item>
                  <lightning-menu-item value="viewall" label="View All" onclick={openScheduledCallsModal}></lightning-menu-item>
                </lightning-button-menu>
              </div>
              <div class="slds-p-horizontal_medium">
                <template if:true={lastRefreshedTime}>
                  <div class="slds-text-body_small slds-text-color_weak slds-p-bottom_x-small">
                    Last refreshed: {lastRefreshedTime}
                  </div>
                </template>
                <template if:true={scheduledCallsList}>
                  <template if:true={scheduledCallsList.length}>
                    <div class="call-list-container">
                      <template for:each={scheduledCallsList} for:item="call" for:index="index">
                        <div key={call.id} class="call-list-item slds-p-vertical_x-small slds-border_bottom">
                          <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                            <div class="slds-col slds-grow">
                              <div class="call-candidate-name">{call.candidateName}</div>
                              <div class="call-details">
                                <span class="call-date">{call.formattedDate}</span>
                              </div>
                            </div>
                            <div class="slds-col slds-no-flex">
                              <lightning-button 
                                variant="brand-outline" 
                                label="Complete" 
                                size="small"
                                data-call-id={call.id}
                                onclick={handleCompleteCall}>
                              </lightning-button>
                            </div>
                          </div>
                        </div>
                      </template>
                    </div>
                  </template>
                  <template if:false={scheduledCallsList.length}>
                    <div class="slds-text-align_center slds-p-vertical_large">
                      <lightning-icon icon-name="utility:check" size="large" class="slds-text-color_success"></lightning-icon>
                      <p class="slds-text-heading_small slds-p-top_small">No scheduled calls</p>
                      <p class="slds-text-body_small slds-text-color_weak">All caught up!</p>
                    </div>
                  </template>
                </template>
              </div>
            </lightning-card>
          </div>

          <!-- Past Due Calls List -->
          <div class="slds-col slds-size_6-of-12">
            <lightning-card title="⚠️ Past Due Calls" icon-name="utility:warning">
              <div slot="actions">
                <lightning-button-menu 
                  alternative-text="Show menu" 
                  icon-size="x-small" 
                  menu-alignment="right">
                  <lightning-menu-item value="refresh" label="Refresh" onclick={loadPastDueCalls}></lightning-menu-item>
                  <lightning-menu-item value="viewall" label="View All" onclick={openPastDueCallsModal}></lightning-menu-item>
                </lightning-button-menu>
              </div>
              <div class="slds-p-horizontal_medium">
                <template if:true={lastRefreshedTime}>
                  <div class="slds-text-body_small slds-text-color_weak slds-p-bottom_x-small">
                    Last refreshed: {lastRefreshedTime}
                  </div>
                </template>
                <template if:true={pastDueCallsList}>
                  <template if:true={pastDueCallsList.length}>
                    <div class="call-list-container">
                      <template for:each={pastDueCallsList} for:item="call" for:index="index">
                        <div key={call.id} class="call-list-item slds-p-vertical_x-small slds-border_bottom past-due">
                          <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                            <div class="slds-col slds-grow">
                              <div class="call-candidate-name">{call.candidateName}</div>
                              <div class="call-details">
                                <span class="call-date overdue">{call.formattedDate}</span>
                                <span class="call-separator"> • </span>
                                <span class="past-due-label">PAST DUE</span>
                              </div>
                            </div>
                            <div class="slds-col slds-no-flex">
                              <lightning-button 
                                variant="destructive-text" 
                                label="Complete" 
                                size="small"
                                data-call-id={call.id}
                                onclick={handleCompleteCall}>
                              </lightning-button>
                            </div>
                          </div>
                        </div>
                      </template>
                    </div>
                  </template>
                  <template if:false={pastDueCallsList.length}>
                    <div class="slds-text-align_center slds-p-vertical_large">
                      <lightning-icon icon-name="utility:success" size="large" class="slds-text-color_success"></lightning-icon>
                      <p class="slds-text-heading_small slds-p-top_small">No past due calls</p>
                      <p class="slds-text-body_small slds-text-color_weak">Great work staying on top of your calls!</p>
                    </div>
                  </template>
                </template>
              </div>
            </lightning-card>
          </div>
        </div>
      </div>

      <!-- Recent Activity - Full Width Horizontal Scroll -->
      <div class="slds-col slds-size_12-of-12 slds-p-top_medium">
        <lightning-card title="🔄 Recent Activity" icon-name="utility:activity">
          <div class="slds-p-around_medium">
            <template if:true={recentActivity.length}>
              <div style="overflow-x: auto; overflow-y: hidden;">
                <div style="display: flex; gap: 8px;">
                  <template for:each={recentActivity} for:item="activity">
                    <div key={activity.id} 
                         data-activity-id={activity.id}
                         onclick={handleActivityClick}
                         style="border: 1px solid #dddbda; border-radius: 4px; padding: 8px; background: #ffffff; min-width: 180px; flex: 0 0 auto; cursor: pointer; transition: all 0.2s ease;"
                         onmouseenter={handleActivityHover}
                         onmouseleave={handleActivityHoverOut}>
                      <div style="margin-bottom: 2px;">
                        <div style="font-size: 0.75rem; font-weight: 600; color: #706e6b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                          {activity.type} {activity.description}
                        </div>
                      </div>
                      <div style="font-size: 0.875rem; color: #0176d3; font-weight: 700; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        {activity.candidateName}
                      </div>
                      <template if:true={activity.dueDate}>
                        <div style="font-size: 0.75rem; color: #c23934; font-weight: 600; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                          📅 {activity.formattedDueDate}
                        </div>
                      </template>
                      <div style="display: flex; justify-content: space-between; align-items: center; gap: 4px; margin-top: 4px;">
                        <span style="font-size: 0.7rem; color: #706e6b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1;">
                          {activity.timeAgo}
                        </span>
                        <lightning-badge label={activity.status} variant={activity.statusVariant} style="font-size: 0.65rem; flex-shrink: 0;"></lightning-badge>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </template>
            <template if:false={recentActivity.length}>
              <div class="slds-text-align_center slds-p-vertical_medium">
                <div class="slds-text-body_regular slds-text-color_weak">No recent activity to display</div>
              </div>
            </template>
          </div>
        </lightning-card>
      </div>

      <!-- Candidate Statistics -->
      <div class="slds-col slds-size_6-of-12 slds-p-top_medium">
        <lightning-card title={pipelineTitle} icon-name="utility:people">
          <div class="slds-p-around_medium">
            
            <!-- Director View: Active/In Progress Candidates by Sales Manager -->
            <template if:true={isDirector}>
              <template if:true={pieChartData}>
                <div class="slds-grid slds-wrap slds-m-bottom_medium">
                  <div class="slds-col slds-size_12">
                    <h3 class="slds-text-heading_small slds-m-bottom_medium slds-text-align_center">📊 Active/In Progress Candidates by Sales Manager</h3>
                    <div class="slds-grid slds-gutters" style="align-items: center;">
                      
                      <!-- Manager Legend List (Left Side) -->
                      <div class="slds-col slds-size_1-of-3">
                        <div class="chart-legend">
                          <template for:each={pieChartData} for:item="item">
                            <div key={item.label} class="legend-item slds-m-bottom_small">
                              <div class="slds-grid slds-grid_vertical-align-center">
                                <div class="legend-color-box" data-color={item.color}></div>
                                <div class="legend-text-wrapper slds-p-left_small">
                                  <button class="manager-name-button" 
                                          onclick={handleSalesManagerClick}
                                          data-manager={item.label}
                                          title="Click to view candidates">
                                    {item.label} →
                                  </button>
                                  <div class="legend-value slds-text-body_small slds-text-color_weak">{item.value} ({item.percentage}%)</div>
                                </div>
                              </div>
                            </div>
                          </template>
                        </div>
                      </div>
                      
                      <!-- Pie Chart (Right Side - Larger) -->
                      <div class="slds-col slds-size_2-of-3">
                        <div class="pie-chart-container">
                          <svg width="500" height="500" viewBox="0 0 500 500" class="pie-chart">
                            <!-- Pie segments -->
                            <template for:each={pieChartData} for:item="segment" for:index="index">
                              <path key={segment.label} 
                                    d={segment.pathData} 
                                    fill={segment.color}
                                    stroke="#fff"
                                    stroke-width="3"
                                    class="pie-segment"
                                    data-manager={segment.label}
                                    onclick={handleSalesManagerClick}
                                    style="cursor: pointer;">
                              </path>
                            </template>
                            <!-- Lines from pie to labels -->
                            <template for:each={pieChartData} for:item="segment" for:index="index">
                              <line key={segment.label}
                                    x1={segment.lineX1}
                                    y1={segment.lineY1}
                                    x2={segment.lineX2}
                                    y2={segment.lineY2}
                                    class="pie-label-line"
                                    stroke={segment.color}
                                    stroke-width="2">
                              </line>
                            </template>
                            <!-- Labels outside segments -->
                            <template for:each={pieChartData} for:item="segment" for:index="index">
                              <text key={segment.label}
                                    x={segment.labelX}
                                    y={segment.labelY}
                                    class="pie-label-outside"
                                    text-anchor="middle"
                                    dominant-baseline="middle"
                                    pointer-events="none"
                                    fill={segment.color}>
                                {segment.initials}
                              </text>
                            </template>
                          </svg>
                        </div>
                      </div>
                      
                    </div>
                  </div>
                </div>
              </template>
              
              <div class="slds-grid slds-wrap slds-m-top_medium">
                <div class="slds-col slds-size_12 slds-p-bottom_small">
                  <div class="slds-text-align_center">
                    <lightning-button 
                      variant="brand" 
                      label="View All Active Candidates" 
                      icon-name="utility:people"
                      onclick={showActiveCandidates} 
                      class="slds-m-top_small">
                    </lightning-button>
                  </div>
                </div>
              </div>
            </template>
            
            <!-- Sales Manager View: User's Pipeline by Highest Level Achieved -->
            <template if:true={isSalesManager}>
              <template if:true={userPieChartData}>
                <div class="slds-grid slds-wrap slds-m-bottom_medium">
                  <div class="slds-col slds-size_12">
                    <div class="slds-text-align_center">
                      <div class="slds-grid slds-grid_align-center">
                        
                        <!-- Pie Chart -->
                        <div class="slds-col slds-size_6-of-12">
                          <div class="pie-chart-container">
                            <svg width="220" height="220" viewBox="0 0 220 220" class="pie-chart">
                              <template for:each={userPieChartData} for:item="segment" for:index="index">
                                <path key={segment.label} 
                                      d={segment.pathData} 
                                      fill={segment.color}
                                      stroke="#fff"
                                      stroke-width="2"
                                      class="pie-segment">
                                </path>
                              </template>
                            </svg>
                          </div>
                        </div>
                        
                        <!-- Legend -->
                        <div class="slds-col slds-size_6-of-12">
                          <div class="chart-legend">
                            <template for:each={userPieChartData} for:item="item">
                              <div key={item.label} class="legend-item slds-m-bottom_x-small">
                                <div class="slds-grid slds-grid_vertical-align-center">
                                  <div class="legend-color-box" data-color={item.color}></div>
                                  <div class="legend-text slds-p-left_small">
                                    <div class="legend-label slds-text-body_small">{item.label}</div>
                                    <div class="legend-value slds-text-body_small slds-text-color_weak">{item.value} ({item.percentage}%)</div>
                                  </div>
                                </div>
                              </div>
                            </template>
                          </div>
                        </div>
                        
                      </div>
                    </div>
                  </div>
                </div>
              </template>
              
              <div class="slds-grid slds-wrap slds-m-top_medium">
                <div class="slds-col slds-size_12 slds-p-bottom_small">
                  <div class="slds-text-align_center">
                    <lightning-button 
                      variant="brand" 
                      label="View My Active Candidates" 
                      icon-name="utility:people"
                      onclick={showActiveCandidates} 
                      class="slds-m-top_small">
                    </lightning-button>
                  </div>
                </div>
              </div>
            </template>
            
            <!-- Default View (Other Users) -->
            <template if:false={isDirector}>
              <template if:false={isSalesManager}>
                <div class="slds-grid slds-wrap slds-m-top_medium">
                  <div class="slds-col slds-size_12 slds-p-bottom_small">
                    <div class="slds-text-align_center">
                      <lightning-button 
                        variant="brand" 
                        label="View All Active Candidates" 
                        icon-name="utility:people"
                        onclick={showActiveCandidates} 
                        class="slds-m-top_small">
                      </lightning-button>
                    </div>
                  </div>
                </div>
              </template>
            </template>
          </div>
        </lightning-card>
      </div>

      <!-- Interview Statistics -->
      <div class="slds-col slds-size_6-of-12">
        <lightning-card title="📊 Interview Leaderboard - Current Month" icon-name="utility:event">
          <div class="slds-p-around_medium">
            <template if:true={interviewerLeaderboard}>
              
              <!-- Top Stats Row -->
              <div class="slds-grid slds-gutters slds-m-bottom_large">
                <div class="slds-col slds-size_1-of-2">
                  <div class="slds-text-align_center slds-p-around_medium" style="background: linear-gradient(135deg, #5a6c7d, #4a5c6d); color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div class="slds-text-heading_large" style="font-size: 2.5rem; font-weight: 700;">{interviewStats.thisWeek}</div>
                    <div class="slds-text-body_regular" style="font-size: 0.875rem; margin-top: 0.25rem;">Interviews This Week</div>
                  </div>
                </div>
                <div class="slds-col slds-size_1-of-2">
                  <div class="slds-text-align_center slds-p-around_medium" style="background: linear-gradient(135deg, #0176d3, #06a59a); color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div class="slds-text-heading_large" style="font-size: 2.5rem; font-weight: 700;">{totalInterviews}</div>
                    <div class="slds-text-body_regular" style="font-size: 0.875rem; margin-top: 0.25rem;">Total This Month</div>
                  </div>
                </div>
              </div>

              <!-- Interview Type Breakdown -->
              <div class="slds-grid slds-wrap slds-gutters slds-m-bottom_large">
                <div class="slds-col slds-size_1-of-5">
                  <div class="slds-text-align_center slds-p-around_small" style="background: #0176d3; color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div class="slds-text-heading_large" style="font-size: 1.75rem; font-weight: 700;">{interviewStats.attraction}</div>
                    <div class="slds-text-body_small" style="margin-top: 0.25rem; font-size: 0.75rem;">Ci-First</div>
                  </div>
                </div>
                <div class="slds-col slds-size_1-of-5">
                  <div class="slds-text-align_center slds-p-around_small" style="background: #06a59a; color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div class="slds-text-heading_large" style="font-size: 1.75rem; font-weight: 700;">{interviewStats.si1}</div>
                    <div class="slds-text-body_small" style="margin-top: 0.25rem; font-size: 0.75rem;">Align-2nd</div>
                  </div>
                </div>
                <div class="slds-col slds-size_1-of-5">
                  <div class="slds-text-align_center slds-p-around_small" style="background: #e74c3c; color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div class="slds-text-heading_large" style="font-size: 1.75rem; font-weight: 700;">{interviewStats.si2}</div>
                    <div class="slds-text-body_small" style="margin-top: 0.25rem; font-size: 0.75rem;">Plan-3rd</div>
                  </div>
                </div>
                <div class="slds-col slds-size_1-of-5">
                  <div class="slds-text-align_center slds-p-around_small" style="background: #f39c12; color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div class="slds-text-heading_large" style="font-size: 1.75rem; font-weight: 700;">{interviewStats.si3}</div>
                    <div class="slds-text-body_small" style="margin-top: 0.25rem; font-size: 0.75rem;">Present-4th</div>
                  </div>
                </div>
                <div class="slds-col slds-size_1-of-5">
                  <div class="slds-text-align_center slds-p-around_small" style="background: #9b59b6; color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div class="slds-text-heading_large" style="font-size: 1.75rem; font-weight: 700;">{interviewStats.career}</div>
                    <div class="slds-text-body_small" style="margin-top: 0.25rem; font-size: 0.75rem;">Optional-5th</div>
                  </div>
                </div>
              </div>

              <!-- Interviewer Rankings by Type -->
              <!-- Interviewer Rankings by Type -->
              <div class="slds-grid slds-wrap slds-gutters">
                
                <!-- Ci-First Rankings -->
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_medium">
                  <div style="background: linear-gradient(to bottom, #f0f7ff 0%, #ffffff 100%); border-left: 4px solid #0176d3; padding: 1.25rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 51, 102, 0.1); border: 1px solid #e0e5ee;">
                    <h3 class="slds-text-heading_small slds-m-bottom_small" style="color: #003366; font-weight: 700; font-size: 1.1rem; letter-spacing: 0.5px; margin-bottom: 1rem; border-bottom: 2px solid #0176d3; padding-bottom: 0.5rem;">Ci-First Interviews</h3>
                    <template if:true={attractionMiniChart}>
                      <template if:true={attractionMiniChart.length}>
                        <template for:each={attractionMiniChart} for:item="segment">
                          <div key={segment.interviewer} 
                               style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: linear-gradient(to right, #ffffff 0%, #f8f9fa 100%); margin-bottom: 0.5rem; border-radius: 6px; cursor: pointer; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #e0e5ee; border-left: 3px solid #0176d3; box-shadow: 0 2px 4px rgba(0, 51, 102, 0.06);"
                               onmouseenter={handleInterviewerHover}
                               onmouseleave={handleInterviewerHoverOut}
                               onclick={handleInterviewerClick}
                               data-interviewer={segment.interviewer}
                               data-interview-type="Ci-First">
                            <span style="font-weight: 600; font-size: 0.95rem; color: #003366; text-decoration: none; letter-spacing: 0.3px;">{segment.interviewer}</span>
                            <span style="background: linear-gradient(135deg, #0176d3 0%, #0190e8 100%); color: white; padding: 0.35rem 0.85rem; border-radius: 16px; font-weight: 700; font-size: 0.9rem; box-shadow: 0 2px 6px rgba(1, 118, 211, 0.25); border: 1px solid rgba(255, 255, 255, 0.2);">{segment.count}</span>
                          </div>
                        </template>
                      </template>
                    </template>
                  </div>
                </div>

                <!-- SI 1 Rankings -->
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_medium">
                  <div style="background: linear-gradient(to bottom, #e6fff9 0%, #ffffff 100%); border-left: 4px solid #06a59a; padding: 1.25rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(6, 165, 154, 0.1); border: 1px solid #d0f0ed;">
                    <h3 class="slds-text-heading_small slds-m-bottom_small" style="color: #003366; font-weight: 700; font-size: 1.1rem; letter-spacing: 0.5px; margin-bottom: 1rem; border-bottom: 2px solid #06a59a; padding-bottom: 0.5rem;">Align-2nd</h3>
                    <template if:true={si1MiniChart}>
                      <template if:true={si1MiniChart.length}>
                        <template for:each={si1MiniChart} for:item="segment">
                          <div key={segment.interviewer} 
                               style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: linear-gradient(to right, #ffffff 0%, #f8f9fa 100%); margin-bottom: 0.5rem; border-radius: 6px; cursor: pointer; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #d0f0ed; border-left: 3px solid #06a59a; box-shadow: 0 2px 4px rgba(6, 165, 154, 0.06);"
                               onmouseenter={handleInterviewerHover}
                               onmouseleave={handleInterviewerHoverOut}
                               onclick={handleInterviewerClick}
                               data-interviewer={segment.interviewer}
                               data-interview-type="Align-2nd">
                            <span style="font-weight: 600; font-size: 0.95rem; color: #003366; text-decoration: none; letter-spacing: 0.3px;">{segment.interviewer}</span>
                            <span style="background: linear-gradient(135deg, #06a59a 0%, #07c4b7 100%); color: white; padding: 0.35rem 0.85rem; border-radius: 16px; font-weight: 700; font-size: 0.9rem; box-shadow: 0 2px 6px rgba(6, 165, 154, 0.25); border: 1px solid rgba(255, 255, 255, 0.2);">{segment.count}</span>
                          </div>
                        </template>
                      </template>
                    </template>
                  </div>
                </div>

                <!-- SI 2 Rankings -->
                <div class="slds-col slds-size_1-of-3 slds-m-bottom_medium">
                  <div style="background: linear-gradient(to bottom, #ffebe6 0%, #ffffff 100%); border-left: 4px solid #e74c3c; padding: 1.25rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(231, 76, 60, 0.1); border: 1px solid #f5d5d0;">
                    <h3 class="slds-text-heading_small slds-m-bottom_small" style="color: #003366; font-weight: 700; font-size: 1.1rem; letter-spacing: 0.5px; margin-bottom: 1rem; border-bottom: 2px solid #e74c3c; padding-bottom: 0.5rem;">Plan-3rd</h3>
                    <template if:true={si2MiniChart}>
                      <template if:true={si2MiniChart.length}>
                        <template for:each={si2MiniChart} for:item="segment">
                          <div key={segment.interviewer} 
                               style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: linear-gradient(to right, #ffffff 0%, #f8f9fa 100%); margin-bottom: 0.5rem; border-radius: 6px; cursor: pointer; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #f5d5d0; border-left: 3px solid #e74c3c; box-shadow: 0 2px 4px rgba(231, 76, 60, 0.06);"
                               onmouseenter={handleInterviewerHover}
                               onmouseleave={handleInterviewerHoverOut}
                               onclick={handleInterviewerClick}
                               data-interviewer={segment.interviewer}
                               data-interview-type="Plan-3rd">
                            <span style="font-weight: 600; font-size: 0.95rem; color: #003366; text-decoration: none; letter-spacing: 0.3px;">{segment.interviewer}</span>
                            <span style="background: linear-gradient(135deg, #e74c3c 0%, #ed6556 100%); color: white; padding: 0.35rem 0.85rem; border-radius: 16px; font-weight: 700; font-size: 0.9rem; box-shadow: 0 2px 6px rgba(231, 76, 60, 0.25); border: 1px solid rgba(255, 255, 255, 0.2);">{segment.count}</span>
                          </div>
                        </template>
                      </template>
                    </template>
                  </div>
                </div>

                <!-- SI 3 Rankings -->
                <div class="slds-col slds-size_1-of-3 slds-m-bottom_medium">
                  <div style="background: linear-gradient(to bottom, #fff4e6 0%, #ffffff 100%); border-left: 4px solid #f4a024; padding: 1.25rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(244, 160, 36, 0.1); border: 1px solid #fce4c4;">
                    <h3 class="slds-text-heading_small slds-m-bottom_small" style="color: #003366; font-weight: 700; font-size: 1.1rem; letter-spacing: 0.5px; margin-bottom: 1rem; border-bottom: 2px solid #f4a024; padding-bottom: 0.5rem;">Present-4th</h3>
                    <template if:true={si3MiniChart}>
                      <template if:true={si3MiniChart.length}>
                        <template for:each={si3MiniChart} for:item="segment">
                          <div key={segment.interviewer} 
                               style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: linear-gradient(to right, #ffffff 0%, #f8f9fa 100%); margin-bottom: 0.5rem; border-radius: 6px; cursor: pointer; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #fce4c4; border-left: 3px solid #f4a024; box-shadow: 0 2px 4px rgba(244, 160, 36, 0.06);"
                               onmouseenter={handleInterviewerHover}
                               onmouseleave={handleInterviewerHoverOut}
                               onclick={handleInterviewerClick}
                               data-interviewer={segment.interviewer}
                               data-interview-type="Present-4th">
                            <span style="font-weight: 600; font-size: 0.95rem; color: #003366; text-decoration: none; letter-spacing: 0.3px;">{segment.interviewer}</span>
                            <span style="background: linear-gradient(135deg, #f4a024 0%, #ffb84d 100%); color: white; padding: 0.35rem 0.85rem; border-radius: 16px; font-weight: 700; font-size: 0.9rem; box-shadow: 0 2px 6px rgba(244, 160, 36, 0.25); border: 1px solid rgba(255, 255, 255, 0.2);">{segment.count}</span>
                          </div>
                        </template>
                      </template>
                    </template>
                  </div>
                </div>

                <!-- Career Rankings -->
                <div class="slds-col slds-size_1-of-3 slds-m-bottom_medium">
                  <div style="background: linear-gradient(to bottom, #f3e6ff 0%, #ffffff 100%); border-left: 4px solid #9b59b6; padding: 1.25rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(155, 89, 182, 0.1); border: 1px solid #e6d5f0;">
                    <h3 class="slds-text-heading_small slds-m-bottom_small" style="color: #003366; font-weight: 700; font-size: 1.1rem; letter-spacing: 0.5px; margin-bottom: 1rem; border-bottom: 2px solid #9b59b6; padding-bottom: 0.5rem;">Optional-5th</h3>
                    <template if:true={careerMiniChart}>
                      <template if:true={careerMiniChart.length}>
                        <template for:each={careerMiniChart} for:item="segment">
                          <div key={segment.interviewer} 
                               style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: linear-gradient(to right, #ffffff 0%, #f8f9fa 100%); margin-bottom: 0.5rem; border-radius: 6px; cursor: pointer; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #e6d5f0; border-left: 3px solid #9b59b6; box-shadow: 0 2px 4px rgba(155, 89, 182, 0.06);"
                               onmouseenter={handleInterviewerHover}
                               onmouseleave={handleInterviewerHoverOut}
                               onclick={handleInterviewerClick}
                               data-interviewer={segment.interviewer}
                               data-interview-type="Optional-5th">
                            <span style="font-weight: 600; font-size: 0.95rem; color: #003366; text-decoration: none; letter-spacing: 0.3px;">{segment.interviewer}</span>
                            <span style="background: linear-gradient(135deg, #9b59b6 0%, #af6fd1 100%); color: white; padding: 0.35rem 0.85rem; border-radius: 16px; font-weight: 700; font-size: 0.9rem; box-shadow: 0 2px 6px rgba(155, 89, 182, 0.25); border: 1px solid rgba(255, 255, 255, 0.2);">{segment.count}</span>
                          </div>
                        </template>
                      </template>
                    </template>
                  </div>
                </div>
                
              </div>
              
            </template>
          </div>
        </lightning-card>
      </div>

      <!-- Net Field Force Analysis -->
      <div class="slds-col slds-size_12-of-12 slds-p-top_medium">
        <lightning-card title="📊 Net Field Force Analysis (2025)" icon-name="custom:custom48">
          <div class="slds-p-around_medium">
            <template if:true={performanceMetrics}>
              <div class="nff-container">
                <!-- Header with Filter -->
                <div class="slds-grid slds-gutters slds-m-bottom_medium">
                  <div class="slds-col slds-size_12-of-12">
                    <lightning-combobox
                      name="nffFirm"
                      label="Filter by Firm"
                      value={selectedNffFirm}
                      placeholder="Select Firm"
                      options={nffFirmOptions}
                      onchange={handleNffFirmChange}
                      class="nff-firm-filter">
                    </lightning-combobox>
                  </div>
                </div>
                
                <!-- Main NFF Display Card -->
                <div class="nff-main-card">
                  <div class="slds-text-align_center">
                    <div class="nff-main-value">{performanceMetrics.netFieldForce}</div>
                    <div class="nff-main-label">Current Net Field Force</div>
                    <div class="nff-main-formula">Begin Year + Recruits - Terminated + Net B Activity</div>
                  </div>
                </div>
                
                <!-- Key Metrics Grid -->
                <div class="slds-grid slds-wrap slds-gutters_small slds-m-bottom_medium">
                  <div class="slds-col slds-size_1-of-5">
                    <div class="nff-metric-card nff-metric-neutral">
                      <div class="nff-metric-icon">📅</div>
                      <div class="nff-metric-value">{performanceMetrics.contractAJan1}</div>
                      <div class="nff-metric-label">Begin Yr NFF</div>
                    </div>
                  </div>
                  <div class="slds-col slds-size_1-of-5">
                    <div class="nff-metric-card nff-metric-positive">
                      <div class="nff-metric-icon">➕</div>
                      <div class="nff-metric-value">+{performanceMetrics.totalContractAAdded}</div>
                      <div class="nff-metric-label">YTD Recruits</div>
                    </div>
                  </div>
                  <div class="slds-col slds-size_1-of-5">
                    <div class="nff-metric-card nff-metric-negative">
                      <div class="nff-metric-icon">➖</div>
                      <div class="nff-metric-value">-{performanceMetrics.totalContractATerms}</div>
                      <div class="nff-metric-label">Terminated</div>
                    </div>
                  </div>
                  <div class="slds-col slds-size_1-of-5">
                    <div class="nff-metric-card nff-metric-warning clickable-metric" onclick={handleNetFieldForceClick}>
                      <div class="nff-metric-icon">🔄</div>
                      <div class="nff-metric-value">{performanceMetrics.netContractBActivity}</div>
                      <div class="nff-metric-label">Net Contract B</div>
                      <div class="nff-click-hint">Click for details</div>
                    </div>
                  </div>
                  <div class="slds-col slds-size_1-of-5">
                    <div class="nff-metric-card nff-metric-info">
                      <div class="nff-metric-icon">⇄</div>
                      <div class="nff-metric-value">{performanceMetrics.totalNetTransfer}</div>
                      <div class="nff-metric-label">Total Net Transfer</div>
                    </div>
                  </div>
                </div>
                
                <!-- NFF by Contract Year Section -->
                <div class="nff-details-section">
                  <h4 class="nff-details-title">NFF by Contract Year</h4>
                  <div class="slds-grid slds-wrap slds-gutters_small">
                    <div class="slds-col slds-size_1-of-4">
                      <div class="nff-detail-item">
                        <div class="nff-detail-value">{performanceMetrics.nffYear1}</div>
                        <div class="nff-detail-label">Year 1</div>
                      </div>
                    </div>
                    <div class="slds-col slds-size_1-of-4">
                      <div class="nff-detail-item">
                        <div class="nff-detail-value">{performanceMetrics.nffYear2}</div>
                        <div class="nff-detail-label">Year 2</div>
                      </div>
                    </div>
                    <div class="slds-col slds-size_1-of-4">
                      <div class="nff-detail-item">
                        <div class="nff-detail-value">{performanceMetrics.nffYear3}</div>
                        <div class="nff-detail-label">Year 3</div>
                      </div>
                    </div>
                    <div class="slds-col slds-size_1-of-4">
                      <div class="nff-detail-item">
                        <div class="nff-detail-value">{performanceMetrics.nffYear4Plus}</div>
                        <div class="nff-detail-label">Year 4+</div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Terminations by Contract Year Section -->
                <div class="nff-details-section">
                  <h4 class="nff-details-title">Terminations by Contract Year</h4>
                  <div class="slds-grid slds-wrap slds-gutters_small">
                    <div class="slds-col slds-size_1-of-4">
                      <div class="nff-detail-item">
                        <div class="nff-detail-value">{performanceMetrics.termsYear1}</div>
                        <div class="nff-detail-label">Year 1</div>
                      </div>
                    </div>
                    <div class="slds-col slds-size_1-of-4">
                      <div class="nff-detail-item">
                        <div class="nff-detail-value">{performanceMetrics.termsYear2}</div>
                        <div class="nff-detail-label">Year 2</div>
                      </div>
                    </div>
                    <div class="slds-col slds-size_1-of-4">
                      <div class="nff-detail-item">
                        <div class="nff-detail-value">{performanceMetrics.termsYear3}</div>
                        <div class="nff-detail-label">Year 3</div>
                      </div>
                    </div>
                    <div class="slds-col slds-size_1-of-4">
                      <div class="nff-detail-item">
                        <div class="nff-detail-value">{performanceMetrics.termsYear4Plus}</div>
                        <div class="nff-detail-label">Year 4+</div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Year End Goal and YTD Goal Section -->
                <div class="nff-details-section">
                  <h4 class="nff-details-title">Goals & Progress</h4>
                  <div class="slds-grid slds-wrap slds-gutters_small">
                    <div class="slds-col slds-size_1-of-2">
                      <div class="nff-goal-item">
                        <div class="nff-goal-header">
                          <span class="nff-goal-icon">🎯</span>
                          <span class="nff-goal-title">Year End Goal</span>
                        </div>
                        <div class="nff-goal-value">{performanceMetrics.yearEndGoal}</div>
                        <div class="nff-goal-progress">
                          <div class="nff-progress-bar">
                            <div class="nff-progress-fill" style={yearEndGoalProgressStyle}></div>
                          </div>
                          <div class="nff-progress-text">{performanceMetrics.yearEndGoalPercent}%</div>
                        </div>
                      </div>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                      <div class="nff-goal-item">
                        <div class="nff-goal-header">
                          <span class="nff-goal-icon">📅</span>
                          <span class="nff-goal-title">YTD Goal</span>
                        </div>
                        <div class="nff-goal-value">{performanceMetrics.ytdGoal}</div>
                        <div class="nff-goal-progress">
                          <div class="nff-progress-bar">
                            <div class="nff-progress-fill" style={ytdGoalProgressStyle}></div>
                          </div>
                          <div class="nff-progress-text">{performanceMetrics.ytdGoalPercent}%</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Performance Indicators -->
                <div class="nff-performance-section">
                  <h4 class="nff-details-title">Performance Indicators</h4>
                  <div class="slds-grid slds-wrap slds-gutters_small">
                    <div class="slds-col slds-size_1-of-3">
                      <div class="nff-performance-card nff-perf-success">
                        <div class="nff-perf-icon">📊</div>
                        <div class="nff-perf-value">{performanceMetrics.overallYear1Retention}%</div>
                        <div class="nff-perf-label">Overall Year1 Retention</div>
                      </div>
                    </div>
                    <div class="slds-col slds-size_1-of-3">
                      <div class="nff-performance-card nff-perf-warning">
                        <div class="nff-perf-icon">📈</div>
                        <div class="nff-perf-value">{performanceMetrics.threeYearCompoundGrowth}%</div>
                        <div class="nff-perf-label">3 Year Compound Growth Rate</div>
                      </div>
                    </div>
                    <div class="slds-col slds-size_1-of-3">
                      <div class="nff-performance-card nff-perf-info">
                        <div class="nff-perf-icon">🎯</div>
                        <div class="nff-perf-value">{performanceMetrics.fourYearRetention}%</div>
                        <div class="nff-perf-label">4 Year Retention (YTD Basis)</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </lightning-card>
      </div>

      <!-- Static Resource Demo -->
      <!-- Static Resource Demo section removed for cleaner dashboard -->

    </div>
  </div>

  <!-- Create Ticket Modal -->
  <template if:true={showCreateTicketModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large" aria-labelledby="create-ticket-modal-heading">
      <div class="slds-modal__container">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeCreateTicketModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="create-ticket-modal-heading" class="slds-text-heading_medium slds-hyphenate">Create Support Ticket</h2>
        </header>
        <div class="slds-modal__content slds-p-around_medium" id="create-ticket-modal-content">
          <lightning-layout multiple-rows>
            <lightning-layout-item size="12" class="slds-p-bottom_small">
              <lightning-input 
                label="Subject" 
                value={ticketSubject} 
                onchange={handleTicketSubjectChange}
                required
                class="slds-p-bottom_small">
              </lightning-input>
            </lightning-layout-item>
            
            <lightning-layout-item size="6" class="slds-p-right_small slds-p-bottom_small">
              <lightning-combobox
                label="Priority"
                value={ticketPriority}
                placeholder="Select Priority"
                options={ticketPriorityOptions}
                onchange={handleTicketPriorityChange}>
              </lightning-combobox>
            </lightning-layout-item>
            
            <lightning-layout-item size="6" class="slds-p-left_small slds-p-bottom_small">
              <lightning-combobox
                label="Category"
                value={ticketCategory}
                placeholder="Select Category"
                options={ticketCategoryOptions}
                onchange={handleTicketCategoryChange}>
              </lightning-combobox>
            </lightning-layout-item>
            
            <lightning-layout-item size="12" class="slds-p-bottom_small">
              <lightning-textarea 
                label="Description" 
                value={ticketDescription} 
                onchange={handleTicketDescriptionChange}
                required
                rows="4"
                class="slds-p-bottom_small">
              </lightning-textarea>
            </lightning-layout-item>
            
            <lightning-layout-item size="12" class="slds-p-bottom_small">
              <lightning-input 
                label="Contact Information" 
                value={ticketContact} 
                onchange={handleTicketContactChange}
                class="slds-p-bottom_small">
              </lightning-input>
            </lightning-layout-item>
            
            <lightning-layout-item size="12" class="slds-p-bottom_small">
              <div class="slds-form-element">
                <label class="slds-form-element__label">Attachments</label>
                <div class="slds-form-element__control">
                  <lightning-button 
                    label="Upload Files" 
                    icon-name="utility:attach" 
                    onclick={handleFileUpload}
                    variant="neutral">
                  </lightning-button>
                  <template if:true={ticketAttachments.length}>
                    <div class="slds-p-top_small">
                      <template for:each={ticketAttachments} for:item="attachment">
                        <div key={attachment.id} class="attachment-item slds-p-vertical_x-small">
                          <lightning-icon icon-name="utility:file" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                          {attachment.name}
                        </div>
                      </template>
                    </div>
                  </template>
                </div>
              </div>
            </lightning-layout-item>
          </lightning-layout>
        </div>
        <footer class="slds-modal__footer">
          <lightning-button variant="neutral" label="Cancel" onclick={closeCreateTicketModal}></lightning-button>
          <lightning-button 
            variant="brand" 
            label="Create Ticket" 
            onclick={submitTicket}
            disabled={isTicketSubmitDisabled}
            icon-name="utility:add">
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Reschedule Calls Modal -->
  <template if:true={showRescheduleCallsModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large" aria-labelledby="reschedule-modal-heading">
      <div class="slds-modal__container" style="max-height: 90vh; width: 95%; max-width: 1400px; background-color: #e8f4ff; overflow: hidden;">
        <header class="slds-modal__header" style="background-color: #0176d3; color: white; padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeRescheduleCallsModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="reschedule-modal-heading" class="slds-text-heading_medium slds-hyphenate" style="color: white;">Reschedule Past Due Calls</h2>
        </header>
        <div class="slds-modal__content" id="reschedule-modal-content" style="overflow-y: auto; overflow-x: hidden; max-height: calc(90vh - 120px); background-color: #e8f4ff; padding: 0.5rem;">
          <!-- Loading State -->
          <template if:true={isLoadingRescheduleCalls}>
            <div class="slds-align_absolute-center" style="padding: 1rem;">
              <lightning-spinner alternative-text="Loading..." size="medium"></lightning-spinner>
            </div>
          </template>
          
          <!-- Main Content -->
          <template if:false={isLoadingRescheduleCalls}>
            <div style="border: 2px solid #0176d3; padding: 0.5rem; border-radius: 8px; background-color: #e8f4ff; max-width: 100%; box-sizing: border-box; overflow: hidden;">
              <!-- Reschedule Form -->
              <template if:true={selectedCallsForReschedule.length}>
                <div class="slds-text-align_center" style="margin-bottom: 0.5rem;">
                  <h3 class="slds-text-heading_small" style="color: #0176d3; margin-bottom: 0.25rem;">📅 Reschedule Form - Selected: {selectedRescheduleCalls.length} calls</h3>
                  <p class="slds-text-body_small">First select calls below, then fill in the new schedule date:</p>
                </div>
                
                <!-- Date/Time Form -->
                <div class="reschedule-form">
                  <lightning-layout multiple-rows>
                    <lightning-layout-item size="12" style="margin-bottom: 0.5rem;">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label slds-text-heading_small" for="reschedule-date">
                          📅 New Schedule Date (Required)
                        </label>
                        <div class="slds-form-element__control">
                          <lightning-input 
                            name="rescheduleDate"
                            type="date" 
                            value={newRescheduleDate}
                            onchange={handleNewRescheduleDateChange}
                            min={todaysDate}
                            variant="standard"
                            class="slds-input_large">
                          </lightning-input>
                      </div>
                    </div>
                  </lightning-layout-item>
                  
                  <lightning-layout-item size="12" style="margin-bottom: 0.5rem;">
                    <div class="slds-form-element">
                      <label class="slds-form-element__label" for="reschedule-time">
                        🕐 New Time (Optional)
                      </label>
                      <div class="slds-form-element__control">
                        <lightning-input 
                          name="rescheduleTime"
                          type="time" 
                          value={newRescheduleTime}
                          onchange={handleNewRescheduleTimeChange}
                          variant="label-hidden"
                          placeholder="Leave blank for day-only scheduling">
                        </lightning-input>
                      </div>
                    </div>
                  </lightning-layout-item>
                  
                  <lightning-layout-item size="12" style="margin-bottom: 0.5rem;">
                    <div class="slds-form-element" style="margin-bottom: 0;">
                      <label class="slds-form-element__label" for="reschedule-notes" style="font-weight: 600; margin-bottom: 0.25rem;">
                        📝 Reschedule Notes (Optional)
                      </label>
                      <div class="slds-form-element__control">
                        <lightning-textarea 
                          name="rescheduleNotes"
                          value={rescheduleNotes}
                          onchange={handleRescheduleNotesChange}
                          rows="2"
                          variant="label-hidden"
                          placeholder="Optional notes about the reschedule...">
                        </lightning-textarea>
                      </div>
                    </div>
                  </lightning-layout-item>
                  
                    <!-- Debug Info -->
                    <lightning-layout-item size="12" style="margin-top: 0.25rem;">
                      <div class="slds-text-body_small slds-text-color_weak">
                        Debug: Date="{newRescheduleDate}" | Time="{newRescheduleTime}" | Notes="{rescheduleNotes}"
                      </div>
                    </lightning-layout-item>
                  </lightning-layout>
                </div>
                
                <!-- Button to Open Call Selection Modal -->
                <div style="margin-top: 0.75rem; text-align: center;">
                  <lightning-button 
                    variant="brand" 
                    label="Select Calls to Reschedule" 
                    icon-name="utility:checkin"
                    onclick={openCallSelectionModal}
                    class="slds-m-bottom_small">
                  </lightning-button>
                  <p class="slds-text-body_small" style="margin-top: 0.5rem;">
                    Selected: <strong>{selectedRescheduleCalls.length}</strong> calls
                  </p>
                </div>
              </template>
              
              <!-- No Calls Found -->
              <template if:false={selectedCallsForReschedule.length}>
                <div class="slds-align_absolute-center" style="padding: 1.5rem;">
                  <div class="slds-text-align_center">
                    <lightning-icon icon-name="utility:success" size="large" style="margin-bottom: 0.5rem;"></lightning-icon>
                    <p class="slds-text-heading_small" style="margin-bottom: 0.25rem;">No Past Due Calls Found</p>
                    <p class="slds-text-body_regular" style="margin: 0;">All calls are up to date!</p>
                  </div>
                </div>
              </template>
            </div>
          </template>
        </div>
        <footer class="slds-modal__footer">
          <lightning-button variant="neutral" label="Cancel" onclick={closeRescheduleCallsModal}></lightning-button>
          <lightning-button 
            variant="brand" 
            label="Reschedule Selected Calls" 
            onclick={submitReschedule}
            disabled={isRescheduleSubmitDisabled}
            icon-name="utility:event">
          </lightning-button>
          <div class="slds-p-top_x-small">
            <p class="slds-text-body_small slds-text-color_weak">
              Debug: Selected={selectedRescheduleCalls.length} calls | Date="{newRescheduleDate}" | Time="{newRescheduleTime}" | HasCalls={hasSelectedCalls} | ButtonDisabled={isRescheduleSubmitDisabled}
            </p>
          </div>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Call Selection Modal (Popup from Reschedule Modal) -->
  <template if:true={showCallSelectionModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large" aria-labelledby="call-selection-modal-heading" style="z-index: 9001;">
      <div class="slds-modal__container" style="max-height: 60vh; width: 95%; max-width: 1400px; background-color: #e8f4ff; overflow: hidden;">
        <header class="slds-modal__header" style="background-color: #0176d3; color: white; padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeCallSelectionModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="call-selection-modal-heading" class="slds-text-heading_medium slds-hyphenate" style="color: white;">Select Calls to Reschedule</h2>
        </header>
        <div class="slds-modal__content" style="overflow-y: auto; overflow-x: hidden; max-height: calc(60vh - 120px); background-color: #e8f4ff; padding: 0.5rem;">
          <div style="border: 2px solid #0176d3; padding: 0.5rem; border-radius: 8px; background-color: #e8f4ff; max-width: 100%; box-sizing: border-box; overflow: hidden;">
            <div style="margin-bottom: 0.5rem;">
              <h4 class="slds-text-heading_small" style="color: #0176d3; margin: 0;">Select Calls to Reschedule:</h4>
              <p class="slds-text-body_small" style="margin-top: 0.25rem;">Currently selected: <strong>{selectedRescheduleCalls.length}</strong> calls</p>
            </div>
            
            <div style="width: 100%; overflow-x: auto; max-height: 400px; overflow-y: auto;">
              <lightning-datatable
                data={selectedCallsForReschedule}
                columns={rescheduleCallColumns}
                key-field="id"
                onrowselection={handleRescheduleCallSelection}
                show-row-number-column
                max-row-selection="1000">
              </lightning-datatable>
            </div>
          </div>
        </div>
        <footer class="slds-modal__footer">
          <lightning-button variant="brand" label="Done" onclick={closeCallSelectionModal}></lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open" style="z-index: 9000;"></div>
  </template>

  <!-- Create New Candidate Modal -->
  <template if:true={showCreateCandidateModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_medium" aria-labelledby="candidate-modal-heading">
      <div class="slds-modal__container">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeCreateCandidateModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="candidate-modal-heading" class="slds-text-heading_medium slds-hyphenate">Create New Candidate</h2>
        </header>
        <div class="slds-modal__content slds-p-around_medium" id="candidate-modal-content">
          <!-- Header Information -->
          <div class="slds-box slds-theme_info" style="background-color: #e8f4ff; border: 2px solid #0176d3; margin-bottom: 1rem;">
            <div class="slds-text-align_center">
              <lightning-icon icon-name="utility:add_contact" size="medium" class="slds-m-bottom_small" style="color: #0176d3;"></lightning-icon>
              <h3 class="slds-text-heading_medium" style="color: #0176d3;">👤 New Candidate Registration</h3>
              <p class="slds-text-body_regular">Enter candidate information below. A Contact record will be created automatically.</p>
            </div>
          </div>

          <!-- Contact Information Section -->
          <div class="ultra-compact-form">
            <div class="form-section">
              <div class="section-header">👤 Contact Information</div>
              
              <!-- Full Name -->
              <div class="compact-field">
                <label class="compact-label" for="new-candidate-name">
                  <abbr class="slds-required" title="required">*</abbr>
                  Full Name
                </label>
                <lightning-input
                  id="new-candidate-name"
                  value={newCandidateName}
                  onchange={handleNewCandidateNameChange}
                  placeholder="Enter candidate's full name"
                  required>
                </lightning-input>
              </div>

              <!-- Email and Phone Row -->
              <div class="compact-field">
                <label class="compact-label" for="new-candidate-email">
                  <abbr class="slds-required" title="required">*</abbr>
                  Email Address
                </label>
                <lightning-input
                  id="new-candidate-email"
                  type="email"
                  value={newCandidateEmail}
                  onchange={handleNewCandidateEmailChange}
                  placeholder="candidate@email.com"
                  required>
                </lightning-input>
              </div>

              <div class="compact-field">
                <label class="compact-label" for="new-candidate-phone">
                  📞 Phone Number
                </label>
                <lightning-input
                  id="new-candidate-phone"
                  type="tel"
                  value={newCandidatePhone}
                  onchange={handleNewCandidatePhoneChange}
                  placeholder="(555) 123-4567">
                </lightning-input>
              </div>
            </div>

            <!-- Candidate Details Section -->
            <div class="form-section">
              <div class="section-header">📋 Candidate Details</div>
              
              <!-- Position -->
              <div class="compact-field">
                <label class="compact-label" for="new-candidate-position">
                  Position
                </label>
                <lightning-combobox
                  id="new-candidate-position"
                  value={newCandidatePosition}
                  placeholder="Select position"
                  options={positionOptions}
                  onchange={handleNewCandidatePositionChange}>
                </lightning-combobox>
              </div>

              <!-- Source -->
              <div class="compact-field">
                <label class="compact-label" for="new-candidate-source">
                  🔍 Lead Source
                </label>
                <lightning-combobox
                  id="new-candidate-source"
                  value={newCandidateSource}
                  placeholder="Select source"
                  options={sourceOptions}
                  onchange={handleNewCandidateSourceChange}>
                </lightning-combobox>
              </div>

              <!-- Notes -->
              <div class="compact-field">
                <label class="compact-label" for="new-candidate-notes">
                  📝 Initial Notes
                </label>
                <lightning-textarea 
                  id="new-candidate-notes"
                  value={newCandidateNotes}
                  onchange={handleNewCandidateNotesChange}
                  placeholder="Enter any initial notes about this candidate..."
                  rows="2">
                </lightning-textarea>
              </div>
            </div>
          </div>

          <!-- Success Preview -->
          <template if:true={newCandidateName}>
            <div class="slds-box slds-theme_success" style="background-color: #f0fff4; border: 1px solid #4bca81; margin-top: 1rem;">
              <div class="slds-text-align_center">
                <h4 class="slds-text-heading_small" style="color: #2e844a;">Preview</h4>
                <p class="slds-text-body_regular">
                  <strong>{newCandidateName}</strong>
                  <template if:true={newCandidateEmail}> • {newCandidateEmail}</template>
                  <template if:true={newCandidatePhone}> • {newCandidatePhone}</template>
                </p>
                <template if:true={newCandidatePosition}>
                  <p class="slds-text-body_small">Position: {newCandidatePosition}</p>
                </template>
                <template if:true={newCandidateSource}>
                  <p class="slds-text-body_small">Source: {newCandidateSource}</p>
                </template>
              </div>
            </div>
          </template>

          <!-- Duplicate Contact Warning -->
          <template if:true={duplicateContactFound}>
            <div class="slds-box slds-theme_warning" style="background-color: #fef7e0; border: 1px solid #fe9339; margin-top: 1rem;">
              <div class="slds-text-align_center">
                <lightning-icon icon-name="utility:warning" size="small" style="color: #fe9339;"></lightning-icon>
                <h4 class="slds-text-heading_small" style="color: #fe9339;">Contact Already Exists</h4>
                <p class="slds-text-body_regular">
                  A contact with email <strong>{newCandidateEmail}</strong> already exists.
                </p>
                <p class="slds-text-body_small">
                  Do you want to create a candidate record for the existing contact?
                </p>
              </div>
            </div>
          </template>
        </div>
        <footer class="slds-modal__footer">
          <lightning-button variant="neutral" label="Cancel" onclick={closeCreateCandidateModal}></lightning-button>
          <lightning-button 
            variant="brand" 
            label="Create Candidate" 
            onclick={handleNewCandidateSubmit}
            disabled={isCandidateSubmitDisabled}
            icon-name="utility:add_contact">
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Schedule Interview Modal -->
  <template if:true={showScheduleInterviewModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_medium" aria-labelledby="schedule-interview-modal-heading">
      <div class="slds-modal__container">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeScheduleInterviewModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="schedule-interview-modal-heading" class="slds-text-heading_medium slds-hyphenate">
            <lightning-icon icon-name="utility:event" size="small" class="slds-m-right_x-small"></lightning-icon>
            Schedule Interview
          </h2>
        </header>
        <div class="slds-modal__content slds-p-around_medium" id="schedule-interview-modal-content">
          
          <!-- Interview Name -->
          <div class="slds-form-element slds-m-bottom_small">
            <label class="slds-form-element__label" for="interview-name">
              <abbr class="slds-required" title="required">*</abbr>
              Interview Name
            </label>
            <div class="slds-form-element__control">
              <lightning-input
                id="interview-name"
                value={selectedCandidateName}
                onchange={handleInterviewNameChange}
                placeholder="Enter interview name"
                required>
              </lightning-input>
            </div>
          </div>

          <!-- Interview Type -->
          <div class="slds-form-element slds-m-bottom_small">
            <label class="slds-form-element__label" for="interview-type">
              <abbr class="slds-required" title="required">*</abbr>
              Interview Type
            </label>
            <div class="slds-form-element__control">
              <lightning-combobox
                id="interview-type"
                value={interviewType}
                placeholder="Select interview type"
                options={interviewTypeOptions}
                onchange={handleInterviewTypeChange}
                required>
              </lightning-combobox>
            </div>
          </div>

          <!-- Contact Information Section -->
          <div class="slds-form-element slds-m-top_medium slds-m-bottom_small">
            <h3 class="slds-text-heading_small slds-m-bottom_small">📞 Contact Information</h3>
          </div>

          <!-- Phone Number -->
          <div class="slds-form-element slds-m-bottom_small">
            <label class="slds-form-element__label" for="interview-phone">
              Phone Number
            </label>
            <div class="slds-form-element__control">
              <lightning-input
                id="interview-phone"
                type="tel"
                value={interviewPhone}
                onchange={handleInterviewPhoneChange}
                placeholder="(555) 555-5555"
                pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}">
              </lightning-input>
            </div>
          </div>

          <!-- Email -->
          <div class="slds-form-element slds-m-bottom_small">
            <label class="slds-form-element__label" for="interview-email">
              Email Address
            </label>
            <div class="slds-form-element__control">
              <lightning-input
                id="interview-email"
                type="email"
                value={interviewEmail}
                onchange={handleInterviewEmailChange}
                placeholder="example@email.com">
              </lightning-input>
            </div>
          </div>

          <!-- Schedule Information Section -->
          <div class="slds-form-element slds-m-top_medium slds-m-bottom_small">
            <h3 class="slds-text-heading_small slds-m-bottom_small">📅 Schedule Information</h3>
          </div>

          <!-- Date and Time Row -->
          <div class="slds-grid slds-gutters slds-m-bottom_small">
            <div class="slds-col slds-size_6-of-12">
              <div class="slds-form-element">
                <label class="slds-form-element__label" for="interview-date">
                  <abbr class="slds-required" title="required">*</abbr>
                  Interview Date
                </label>
                <div class="slds-form-element__control">
                  <lightning-input
                    id="interview-date"
                    type="date"
                    value={interviewDate}
                    onchange={handleInterviewDateChange}
                    required>
                  </lightning-input>
                </div>
              </div>
            </div>
            <div class="slds-col slds-size_6-of-12">
              <div class="slds-form-element">
                <label class="slds-form-element__label" for="interview-time">
                  <abbr class="slds-required" title="required">*</abbr>
                  Interview Time
                </label>
                <div class="slds-form-element__control">
                  <lightning-input
                    id="interview-time"
                    type="time"
                    value={interviewTime}
                    onchange={handleInterviewTimeChange}
                    required>
                  </lightning-input>
                </div>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="slds-form-element slds-m-bottom_small">
            <label class="slds-form-element__label" for="interview-notes">
              Notes
            </label>
            <div class="slds-form-element__control">
              <lightning-textarea
                id="interview-notes"
                value={interviewNotes}
                onchange={handleInterviewNotesChange}
                placeholder="Add any additional notes or details about the interview..."
                rows="3">
              </lightning-textarea>
            </div>
          </div>

        </div>
        <footer class="slds-modal__footer">
          <lightning-button variant="neutral" label="Cancel" onclick={closeScheduleInterviewModal}></lightning-button>
          <lightning-button variant="brand" label="Schedule Interview" onclick={handleScheduleInterview} icon-name="utility:check"></lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Call Management Modal (Scheduled & Past Due Calls) -->
  <template if:true={showCallManagementModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large" aria-labelledby="calls-modal-heading">
      <div class="slds-modal__container" style="max-height: 85vh;">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeCallManagementModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="calls-modal-heading" class="slds-text-heading_medium slds-hyphenate">{callModalTitle}</h2>
        </header>
        <div class="slds-modal__content slds-p-around_medium" id="calls-modal-content">
          
          <!-- Loading State -->
          <template if:true={isLoadingCalls}>
            <div class="slds-align_absolute-center slds-p-around_large">
              <lightning-spinner alternative-text="Loading calls..." size="medium"></lightning-spinner>
            </div>
          </template>

          <!-- No Calls State -->
          <template if:false={isLoadingCalls}>
            <template if:false={callsList.length}>
              <div class="slds-text-align_center slds-p-around_large">
                <lightning-icon icon-name="utility:success" size="large" class="slds-m-bottom_medium" style="color: #4bca81;"></lightning-icon>
                <h3 class="slds-text-heading_medium slds-m-bottom_small">All Caught Up! 🎉</h3>
                <p class="slds-text-body_regular">No {callType} calls to display.</p>
              </div>
            </template>

            <!-- Calls List -->
            <template if:true={callsList.length}>
              <!-- Quick Actions Header -->
              <div class="slds-box slds-theme_info" style="background-color: #e8f4ff; border: 2px solid #0176d3; margin-bottom: 1rem;">
                <div class="slds-text-align_center">
                  <h3 class="slds-text-heading_medium" style="color: #0176d3;">📞 Call Management - {callsList.length} Calls</h3>
                  <p class="slds-text-body_regular">Click any call below to quickly complete it</p>
                </div>
              </div>

              <!-- Scrolling Call List -->
              <div class="call-list-container" style="max-height: 50vh; overflow-y: auto;">
                <template for:each={callsList} for:item="call">
                  <div key={call.id} class="call-item" onclick={selectCallForCompletion} data-call-id={call.id}>
                    <lightning-card>
                      <div class="slds-grid slds-gutters slds-p-around_small">
                        <!-- Call Priority Indicator -->
                        <div class="slds-col slds-size_1-of-12 slds-text-align_center">
                          <div class="priority-indicator" data-priority={call.priority}>
                            <lightning-icon icon-name="utility:priority" size="small" 
                              class={call.priorityClass}></lightning-icon>
                          </div>
                        </div>

                        <!-- Call Details -->
                        <div class="slds-col slds-size_7-of-12">
                          <div class="slds-grid">
                            <div class="slds-col slds-size_12-of-12">
                              <h4 class="slds-text-heading_small slds-m-bottom_x-small">
                                <strong>{call.candidateName}</strong>
                              </h4>
                              <p class="slds-text-body_regular slds-m-bottom_x-small">{call.subject}</p>
                              <div class="slds-text-body_small slds-text-color_weak">
                                📞 {call.phone} • 📧 {call.email}
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- Call Timing -->
                        <div class="slds-col slds-size_3-of-12">
                          <div class="slds-text-align_right">
                            <div class="slds-text-body_small slds-m-bottom_x-small">
                              <strong>{call.scheduledDate}</strong>
                            </div>
                            <div class="slds-text-body_small slds-text-color_weak">
                              {call.scheduledTime}
                            </div>
                            <template if:true={call.daysOverdue}>
                              <lightning-badge label={call.overdueLabel} variant="error" class="slds-m-top_x-small"></lightning-badge>
                            </template>
                          </div>
                        </div>

                        <!-- Quick Complete Button -->
                        <div class="slds-col slds-size_1-of-12 slds-text-align_center">
                          <lightning-button-icon 
                            icon-name="utility:check" 
                            variant="brand" 
                            alternative-text="Complete Call"
                            title="Complete Call"
                            onclick={selectCallForCompletion}
                            data-call-id={call.id}>
                          </lightning-button-icon>
                        </div>
                      </div>
                    </lightning-card>
                  </div>
                </template>
              </div>
            </template>
          </template>
        </div>
        <footer class="slds-modal__footer">
          <lightning-button variant="neutral" label="Close" onclick={closeCallManagementModal}></lightning-button>
          <lightning-button 
            variant="brand" 
            label="Bulk Actions" 
            icon-name="utility:settings"
            onclick={showBulkActions}
            disabled={isLoadingCalls}>
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Call Completion Modal -->
  <template if:true={showCallCompletionModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_small" aria-labelledby="completion-modal-heading">
      <div class="slds-modal__container call-completion-modal-container">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeCallCompletionModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="completion-modal-heading" class="slds-text-heading_small slds-hyphenate">Complete Call</h2>
        </header>
        <div class="slds-modal__content" id="completion-modal-content" style="padding: 12px 16px;">
          
          <!-- Compact Call Summary -->
          <template if:true={selectedCall}>
            <div class="compact-call-summary" 
                 style="background: #f0fff4; border-left: 3px solid #4bca81; padding: 8px 12px; margin-bottom: 12px; border-radius: 4px;">
              <h3 class="slds-text-body_regular" style="color: #2e844a; margin: 0 0 2px 0; font-weight: 600;">
                📞 {selectedCall.candidateName}
              </h3>
              <p class="slds-text-body_small slds-text-color_weak" style="margin: 0; font-size: 0.75rem;">
                {selectedCall.subject} • {selectedCall.formattedDate} {selectedCall.formattedTime}
              </p>
            </div>
          </template>

          <!-- Compact Completion Form -->
          <div class="compact-completion-form">
            
            <!-- Due Date -->
            <div class="slds-form-element" style="margin-bottom: 10px;">
              <label class="slds-form-element__label slds-text-body_small" style="margin-bottom: 4px; font-weight: 600;">
                📅 Due Date
              </label>
              <div class="slds-form-element__control">
                <lightning-input 
                  type="date"
                  name="callDueDate"
                  value={editableCallDueDate}
                  onchange={handleCallDueDateChange}
                  variant="standard">
                </lightning-input>
              </div>
            </div>
            
            <!-- Call Outcome (Required) -->
            <div class="slds-form-element" style="margin-bottom: 10px;">
              <label class="slds-form-element__label slds-text-body_small" style="margin-bottom: 4px; font-weight: 600;">
                <abbr class="slds-required" title="required">*</abbr> Call Outcome
              </label>
              <div class="slds-form-element__control">
                <lightning-radio-group 
                  name="callOutcome"
                  options={callOutcomeOptions}
                  value={callOutcome}
                  onchange={handleCallOutcomeChange}
                  type="button">
                </lightning-radio-group>
              </div>
            </div>

            <!-- Quick Notes -->
            <div class="slds-form-element" style="margin-bottom: 10px;">
              <label class="slds-form-element__label slds-text-body_small" style="margin-bottom: 4px; font-weight: 600;">
                📝 Call Notes (Optional)
              </label>
              <div class="slds-form-element__control">
                <lightning-textarea 
                  name="callNotes"
                  value={callNotes}
                  onchange={handleCallNotesChange}
                  placeholder="Brief notes about the call..."
                  rows="2"
                  variant="standard">
                </lightning-textarea>
              </div>
            </div>


          </div>
        </div>
        <footer class="slds-modal__footer" style="padding: 8px 16px;">
          <lightning-button variant="neutral" label="Cancel" onclick={closeCallCompletionModal}></lightning-button>
          <lightning-button 
            variant="brand-outline" 
            label="Create Follow Up Call"
            onclick={openFollowUpCallModal}
            icon-name="utility:add_contact">
          </lightning-button>
          <lightning-button 
            variant="brand" 
            label="Complete Call" 
            onclick={submitCallCompletion}
            disabled={isCallCompletionDisabled}
            icon-name="utility:check">
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Schedule Call Modal -->
  <template if:true={showScheduleCallModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_medium" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1">
      <div class="slds-modal__container">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeScheduleCallModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
            <span class="slds-assistive-text">Close</span>
          </button>
          <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">
            <lightning-icon icon-name="utility:phone_portrait" size="small" class="slds-m-right_x-small"></lightning-icon>
            Schedule New Call
          </h2>
        </header>
        <div class="slds-modal__content ultra-compact-modal" id="modal-content-id-1">
          <div class="ultra-compact-form">
            
            <!-- Call Details Section -->
            <div class="form-section">
              <div class="section-header">📞 Call Details</div>
                  
              <!-- Subject -->
              <div class="compact-field">
                <label class="compact-label" for="call-subject">
                  <abbr class="slds-required" title="required">*</abbr>
                  Call Subject
                </label>
                <lightning-input
                  id="call-subject"
                  value={scheduleCallSubject}
                  onchange={handleScheduleCallSubjectChange}
                  placeholder="Enter call subject (e.g., Initial Screening Call)"
                  required>
                </lightning-input>
              </div>

              <!-- Contact Lookup -->
              <div class="compact-field">
                <label class="compact-label" for="call-contact">
                  <abbr class="slds-required" title="required">*</abbr>
                  Contact
                </label>
                <div class="contact-lookup-container">
                  <lightning-input
                    id="call-contact"
                    value={scheduleCallContactName}
                    onchange={handleScheduleCallContactChange}
                    onfocus={handleContactFocus}
                    onblur={handleContactBlur}
                    placeholder="Start typing to search contacts..."
                    required>
                  </lightning-input>
                  <template if:true={showContactOptions}>
                    <div class="contact-dropdown slds-dropdown slds-dropdown_fluid slds-dropdown_length-5">
                      <ul class="slds-dropdown__list" role="listbox">
                        <template if:true={isSearchingContacts}>
                          <li class="contact-dropdown-item" role="option">
                            <div class="contact-option">
                              <div class="contact-name">Searching contacts...</div>
                            </div>
                          </li>
                        </template>
                        <template if:false={isSearchingContacts}>
                          <template for:each={contactOptions} for:item="contact">
                            <li key={contact.Id} class="contact-dropdown-item" role="option" onclick={handleContactSelect} data-contact-id={contact.Id}>
                              <div class="contact-option" data-contact-id={contact.Id}>
                                <div class="contact-name" data-contact-id={contact.Id}>{contact.Name}</div>
                                <template if:true={contact.Email}>
                                  <div class="contact-email" data-contact-id={contact.Id}>{contact.Email}</div>
                                </template>
                                <template if:true={contact.Account}>
                                  <div class="contact-company" data-contact-id={contact.Id}>Company: {contact.Account}</div>
                                </template>
                              </div>
                            </li>
                          </template>
                          <template if:true={noContactsFound}>
                            <li class="contact-dropdown-item" role="option">
                              <div class="contact-option">
                                <div class="contact-name">No contacts found</div>
                              </div>
                            </li>
                          </template>
                        </template>
                      </ul>
                    </div>
                  </template>
                </div>
              </div>
            </div>

            <!-- Schedule Information -->
            <div class="form-section">
              <div class="section-header">📅 Schedule Information</div>
              <!-- Call Date -->
              <div class="compact-field">
                <label class="compact-label" for="call-date">
                  <abbr class="slds-required" title="required">*</abbr>
                  Call Date
                </label>
                <lightning-input
                  type="date"
                  id="call-date"
                  value={scheduleCallDate}
                  onchange={handleScheduleCallDateChange}
                  min={todayDate}
                  required>
                </lightning-input>
              </div>

              <!-- Priority and Status Row -->
              <div class="compact-row">
                <div class="compact-field-half">
                  <label class="compact-label" for="call-priority">Priority</label>
                  <lightning-combobox
                    id="call-priority"
                    value={scheduleCallPriority}
                    onchange={handleScheduleCallPriorityChange}
                    options={callPriorityOptions}
                    placeholder="Select priority level">
                  </lightning-combobox>
                </div>
                <div class="compact-field-half">
                  <label class="compact-label" for="call-status">Status</label>
                  <lightning-combobox
                    id="call-status"
                    value={scheduleCallStatus}
                    onchange={handleScheduleCallStatusChange}
                    options={callStatusOptions}
                    placeholder="Select call status">
                  </lightning-combobox>
                </div>
              </div>
              <!-- Call Notes/Agenda -->
              <div class="compact-field">
                <label class="compact-label" for="call-description">
                  Call Notes/Agenda
                </label>
                <lightning-textarea
                  id="call-description"
                  value={scheduleCallDescription}
                  onchange={handleScheduleCallDescriptionChange}
                  placeholder="Enter call agenda, topics to discuss, or any preparation notes..."
                  max-length="32000"
                  rows="2">
                </lightning-textarea>
              </div>
            </div>

          </div>
        </div>
        <footer class="slds-modal__footer">
          <lightning-button 
            variant="neutral" 
            label="Cancel" 
            onclick={closeScheduleCallModal}>
          </lightning-button>
          <lightning-button 
            variant="brand" 
            label="Schedule Call" 
            onclick={submitScheduleCall}
            disabled={isScheduleCallDisabled}
            icon-name="utility:phone_portrait">
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Active Candidates Modal -->
  <template if:true={showCandidateModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_medium" aria-labelledby="candidate-modal-heading">
      <div class="slds-modal__container" style="max-height: 80vh;">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeCandidateModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="active-candidate-modal-heading" class="slds-modal__title slds-hyphenate slds-text-heading_small">
            <lightning-icon icon-name="utility:people" size="small" class="slds-m-right_x-small"></lightning-icon>
            {candidateModalTitle}
          </h2>
        </header>
        <div class="slds-modal__content" id="active-candidates-modal-content" style="max-height: 60vh; overflow-y: auto; padding: 1rem;">
          
          <template if:true={isLoadingCandidates}>
            <div class="slds-text-align_center slds-p-around_large">
              <lightning-spinner alternative-text="Loading candidates..." size="medium"></lightning-spinner>
              <p class="slds-text-body_regular slds-m-top_small">Loading active candidates...</p>
            </div>
          </template>

          <template if:false={isLoadingCandidates}>
            <template if:true={candidateModalData}>
              <template if:true={candidateModalData.length}>
                
                <!-- Candidates List -->
                <div class="candidates-list-container">
                  <div class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                    Showing {candidateModalData.length} active candidates
                  </div>
                  
                  <template for:each={candidateModalData} for:item="candidate">
                    <div key={candidate.id} class="candidate-list-item slds-box slds-theme_shade" 
                         onclick={handleCandidateClick} data-candidate-id={candidate.id} 
                         title="Click to view candidate details">
                      <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-start" style="gap: 12px;">
                        <div class="slds-col slds-size_5-of-12">
                          <div style="margin-bottom: 4px;">
                            <strong style="font-size: 16px; color: #181818;">{candidate.name}</strong>
                          </div>
                          <div style="font-size: 14px; color: #666; line-height: 1.3;">
                            {candidate.position}
                          </div>
                          <div style="font-size: 13px; color: #888; margin-top: 2px;">
                            Owner: {candidate.ownerName}
                          </div>
                        </div>
                        <div class="slds-col slds-size_5-of-12">
                          <template if:true={candidate.email}>
                            <div style="margin-bottom: 4px;">
                              📧 <a href={candidate.emailLink} 
                                    onclick={handleEmailClick} 
                                    data-candidate-id={candidate.id}
                                    title={candidate.email}
                                    style="text-decoration: underline; color: #0176d3;">{candidate.email}</a>
                            </div>
                          </template>
                          <template if:true={candidate.phone}>
                            <div>
                              📞 <a href={candidate.phoneLink} 
                                    onclick={handlePhoneClick}
                                    data-candidate-id={candidate.id}
                                    style="text-decoration: underline; color: #0176d3;">{candidate.phone}</a>
                            </div>
                          </template>
                        </div>
                        <div class="slds-col slds-size_2-of-12 slds-text-align_right">
                          <div class="slds-badge slds-badge_success" style="font-size: 12px; padding: 4px 8px;">
                            Active
                          </div>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>

              </template>
              <template if:false={candidateModalData.length}>
                <div class="slds-text-align_center slds-p-around_large">
                  <lightning-icon icon-name="utility:info" size="large" class="slds-m-bottom_medium"></lightning-icon>
                  <h3 class="slds-text-heading_small slds-m-bottom_small">No Active Candidates Found</h3>
                  <p class="slds-text-body_regular slds-text-color_weak">
                    There are currently no candidates with "Active/In Process" status.
                  </p>
                </div>
              </template>
            </template>
          </template>

        </div>
        <footer class="slds-modal__footer slds-p-vertical_small slds-p-horizontal_medium">
          <lightning-button variant="neutral" label="Close" onclick={closeCandidateModal}></lightning-button>
          <lightning-button variant="brand" label="Add New Candidate" disabled title="Coming Soon"></lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Sales Manager Candidates Modal -->
  <template if:true={showSalesManagerCandidatesModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_medium" aria-labelledby="sales-manager-modal-heading">
      <div class="slds-modal__container" style="max-height: 80vh;">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeSalesManagerCandidatesModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="sales-manager-modal-heading" class="slds-modal__title slds-hyphenate slds-text-heading_small">
            <lightning-icon icon-name="utility:people" size="small" class="slds-m-right_x-small"></lightning-icon>
            {salesManagerCandidatesModalTitle}
          </h2>
        </header>
        <div class="slds-modal__content" id="sales-manager-modal-content" style="max-height: 60vh; overflow-y: auto; padding: 1rem;">
          
          <template if:true={isLoadingSalesManagerCandidates}>
            <div class="slds-text-align_center slds-p-around_large">
              <lightning-spinner alternative-text="Loading candidates..." size="medium"></lightning-spinner>
              <p class="slds-text-body_regular slds-m-top_small">Loading candidates for {selectedSalesManager}...</p>
            </div>
          </template>

          <template if:false={isLoadingSalesManagerCandidates}>
            <template if:true={salesManagerCandidates}>
              <template if:true={salesManagerCandidates.length}>
                
                <!-- Candidates List -->
                <div class="candidates-list-container">
                  <div class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                    Showing {salesManagerCandidates.length} active candidates for {selectedSalesManager}
                  </div>
                  
                  <template for:each={salesManagerCandidates} for:item="candidate">
                    <div key={candidate.id} class="candidate-list-item slds-box slds-theme_shade" 
                         onclick={handleCandidateClick} data-candidate-id={candidate.id} 
                         title="Click to view candidate details">
                      <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-start" style="gap: 12px;">
                        <div class="slds-col slds-size_5-of-12">
                          <div style="margin-bottom: 4px;">
                            <strong style="font-size: 16px; color: #181818;">{candidate.name}</strong>
                          </div>
                          <div style="font-size: 14px; color: #666; line-height: 1.3;">
                            {candidate.position}
                          </div>
                          <div style="font-size: 13px; color: #888; margin-top: 2px;">
                            📍 {candidate.location}
                          </div>
                          <div style="font-size: 13px; color: #888; margin-top: 2px;">
                            Recruiter: {candidate.recruiter}
                          </div>
                        </div>
                        <div class="slds-col slds-size_5-of-12">
                          <template if:true={candidate.email}>
                            <div style="margin-bottom: 4px;">
                              📧 <a href={candidate.emailLink} 
                                    onclick={handleEmailClick} 
                                    data-candidate-id={candidate.id}
                                    title={candidate.email}
                                    style="text-decoration: underline; color: #0176d3;">{candidate.email}</a>
                            </div>
                          </template>
                          <template if:true={candidate.phone}>
                            <div style="margin-bottom: 4px;">
                              📞 <a href={candidate.phoneLink} 
                                    onclick={handlePhoneClick}
                                    data-candidate-id={candidate.id}
                                    style="text-decoration: underline; color: #0176d3;">{candidate.phone}</a>
                            </div>
                          </template>
                          <div style="font-size: 13px; color: #666; margin-top: 4px;">
                            Next Meeting: {candidate.nextMeeting}
                          </div>
                        </div>
                        <div class="slds-col slds-size_2-of-12 slds-text-align_right">
                          <div class="slds-badge slds-badge_success" style="font-size: 12px; padding: 4px 8px;">
                            Active
                          </div>
                          <div style="font-size: 11px; color: #888; margin-top: 4px;">
                            {candidate.experience}
                          </div>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>

              </template>
              <template if:false={salesManagerCandidates.length}>
                <div class="slds-text-align_center slds-p-around_large">
                  <lightning-icon icon-name="utility:info" size="large" class="slds-m-bottom_medium"></lightning-icon>
                  <h3 class="slds-text-heading_small slds-m-bottom_small">No Active Candidates Found</h3>
                  <p class="slds-text-body_regular slds-text-color_weak">
                    {selectedSalesManager} has no candidates with "Active/In Process" status at this time.
                  </p>
                </div>
              </template>
            </template>
          </template>

        </div>
        <footer class="slds-modal__footer slds-p-vertical_small slds-p-horizontal_medium">
          <lightning-button variant="neutral" label="Close" onclick={closeSalesManagerCandidatesModal}></lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Candidate Detail Modal - Editable & Scrollable -->
  <template if:true={showCandidateDetailModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_medium" aria-labelledby="candidate-detail-modal-heading">
      <div class="slds-modal__container" style="max-height: 80vh;">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeCandidateDetailModal}>
            <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
          </button>
          <h2 id="candidate-detail-modal-heading" class="slds-text-heading_medium slds-hyphenate">
            Edit Candidate: {candidateEditName}
          </h2>
        </header>
        <div class="slds-modal__content slds-p-around_medium" style="overflow-y: auto; max-height: 60vh;">

            <!-- Editable Form Fields -->
            <form class="slds-form slds-form_stacked">
              
              <!-- Basic Information -->
              <div class="slds-form-element slds-m-bottom_small">
                <label class="slds-form-element__label" for="candidate-name">
                  <abbr class="slds-required" title="required">* </abbr>Candidate Name
                </label>
                <div class="slds-form-element__control">
                  <lightning-input 
                    id="candidate-name"
                    value={candidateEditName}
                    onchange={handleCandidateNameChange}
                    required>
                  </lightning-input>
                </div>
              </div>

              <!-- Contact Information Section -->
              <fieldset class="slds-form-element slds-m-bottom_small">
                <legend class="slds-form-element__legend slds-text-heading_small">Contact Information</legend>
                
                <div class="slds-form-element__control">
                  <div class="slds-grid slds-gutters slds-wrap">
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="candidate-email">Email</label>
                        <div class="slds-form-element__control">
                          <lightning-input 
                            id="candidate-email"
                            type="email"
                            value={candidateEditEmail}
                            onchange={handleCandidateEmailChange}>
                          </lightning-input>
                        </div>
                      </div>
                    </div>
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="candidate-phone">Phone</label>
                        <div class="slds-form-element__control">
                          <lightning-input 
                            id="candidate-phone"
                            type="tel"
                            value={candidateEditPhone}
                            onchange={handleCandidatePhoneChange}>
                          </lightning-input>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>

              <!-- Professional Information -->
              <fieldset class="slds-form-element slds-m-bottom_small">
                <legend class="slds-form-element__legend slds-text-heading_small">Professional Details</legend>
                
                <div class="slds-form-element__control">
                  <div class="slds-grid slds-gutters slds-wrap">
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="candidate-position">Position</label>
                        <div class="slds-form-element__control">
                          <lightning-combobox
                            id="candidate-position"
                            value={candidateEditPosition}
                            options={positionOptions}
                            onchange={handleCandidatePositionChange}>
                          </lightning-combobox>
                        </div>
                      </div>
                    </div>
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="candidate-status">Status</label>
                        <div class="slds-form-element__control">
                          <lightning-combobox
                            id="candidate-status"
                            value={candidateEditStatus}
                            options={statusOptions}
                            onchange={handleCandidateStatusChange}>
                          </lightning-combobox>
                        </div>
                      </div>
                    </div>
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="office-location">Office Location</label>
                        <div class="slds-form-element__control">
                          <lightning-combobox
                            id="office-location"
                            value={candidateEditOfficeLocation}
                            options={officeLocationOptions}
                            onchange={handleOfficeLocationChange}>
                          </lightning-combobox>
                        </div>
                      </div>
                    </div>
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="sales-manager">Sales Manager</label>
                        <div class="slds-form-element__control">
                          <lightning-combobox
                            id="sales-manager"
                            value={candidateEditSalesManager}
                            options={salesManagerOptions}
                            onchange={handleSalesManagerChange}>
                          </lightning-combobox>
                        </div>
                      </div>
                    </div>
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="recruiter">Recruiter</label>
                        <div class="slds-form-element__control">
                          <lightning-combobox
                            id="recruiter"
                            value={candidateEditRecruiter}
                            options={recruiterOptions}
                            onchange={handleRecruiterChange}>
                          </lightning-combobox>
                        </div>
                      </div>
                    </div>
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="next-meeting">Next Meeting</label>
                        <div class="slds-form-element__control">
                          <div class="slds-form-element__static">{candidateEditNextMeeting}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>

              <!-- Notes and Summary -->
              <fieldset class="slds-form-element slds-m-bottom_small">
                <legend class="slds-form-element__legend slds-text-heading_small">Notes & Summary</legend>
                
                <div class="slds-form-element__control">
                  <div class="slds-grid slds-gutters slds-wrap">
                    
                    <div class="slds-col slds-size_1-of-1">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="candidate-summary">Candidate Summary</label>
                        <div class="slds-form-element__control">
                          <lightning-textarea
                            id="candidate-summary"
                            value={candidateEditSummary}
                            onchange={handleCandidateSummaryChange}>
                          </lightning-textarea>
                        </div>
                      </div>
                    </div>
                    
                    <div class="slds-col slds-size_1-of-1">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label" for="all-notes">All Notes</label>
                        <div class="slds-form-element__control">
                          <lightning-textarea
                            id="all-notes"
                            value={candidateEditAllNotes}
                            onchange={handleAllNotesChange}>
                          </lightning-textarea>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>

              <!-- Timeline Information -->
              <fieldset class="slds-form-element">
                <legend class="slds-form-element__legend slds-text-heading_small">Timeline</legend>
                
                <div class="slds-form-element__control">
                  <div class="slds-grid slds-gutters">
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label">Created Date</label>
                        <div class="slds-form-element__control">
                          <div class="slds-form-element__static">{candidateEditCreatedDate}</div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="slds-col slds-size_1-of-2">
                      <div class="slds-form-element">
                        <label class="slds-form-element__label">Last Modified</label>
                        <div class="slds-form-element__control">
                          <div class="slds-form-element__static">{candidateEditLastModified}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>
            </form>

        </div>
        <footer class="slds-modal__footer">
          <lightning-button 
            variant="neutral" 
            label="Cancel" 
            onclick={closeCandidateDetailModal}>
          </lightning-button>
          <lightning-button 
            variant="brand" 
            label="Save Changes" 
            onclick={saveCandidateChanges}
            class="slds-m-left_x-small">
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Interview Details Modal -->
  <template if:true={showInterviewDetailsModal}>
    <section role="dialog" tabindex="-1" aria-modal="true" class="slds-modal slds-fade-in-open slds-modal_large">
      <div class="slds-modal__container">
        <header class="slds-modal__header" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <lightning-button
            icon-name="utility:close"
            variant="bare"
            onclick={closeInterviewDetailsModal}
            class="slds-modal__close">
          </lightning-button>
          <h2 class="slds-text-heading_medium slds-hyphenate">{interviewDetailsTitle}</h2>
        </header>
        <div class="slds-modal__content slds-p-around_medium" id="modal-content" style="max-height: 60vh; overflow-y: auto; overflow-x: hidden;">
          <template if:true={interviewDetailsList}>
            <template if:true={interviewDetailsList.length}>
              <div class="slds-grid slds-wrap slds-gutters_small">
                <template for:each={interviewDetailsList} for:item="interview">
                  <div key={interview.id} class="slds-col slds-size_1-of-1">
                    <div class="slds-box" style="background: #f3f3f3; border-left: 4px solid #0176d3; padding: 0.35rem 0.5rem; margin-bottom: 0.35rem;">
                      <div class="slds-grid slds-grid_vertical-align-center">
                        <div class="slds-col slds-size_2-of-3">
                          <div style="font-weight: 600; font-size: 0.875rem; color: #3e3e3c; margin-bottom: 0.1rem;">
                            {interview.candidateName}
                          </div>
                          <div style="font-size: 0.75rem; color: #706e6b;">
                            📅 {interview.interviewDate}
                          </div>
                        </div>
                        <div class="slds-col slds-size_1-of-3 slds-text-align_right">
                          <lightning-badge label={interview.status} class={interview.statusClass}></lightning-badge>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </template>
            <template if:false={interviewDetailsList.length}>
              <div class="slds-text-align_center slds-p-around_large">
                <p class="slds-text-color_weak">No interviews found for this interviewer.</p>
              </div>
            </template>
          </template>
        </div>
        <footer class="slds-modal__footer">
          <lightning-button 
            variant="neutral" 
            label="Close" 
            onclick={closeInterviewDetailsModal}>
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- View All Scheduled Calls Modal -->
  <template if:true={showAllScheduledCallsModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large">
      <div class="slds-modal__container" style="background-color: white;">
        <header class="slds-modal__header" style="background-color: white; padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick={closeScheduledCallsModal}>
            <lightning-icon icon-name="utility:close" alternative-text="Close" size="small"></lightning-icon>
          </button>
          <h2 class="slds-text-heading_medium">All Scheduled Calls ({allScheduledCalls.length})</h2>
        </header>
        <div class="slds-modal__content slds-p-around_small" style="background-color: white; padding-top: 0;">
          <template if:true={allScheduledCalls}>
            <template if:true={allScheduledCalls.length}>
              <ul class="slds-has-dividers_bottom-space" style="background-color: white; margin: 0; padding: 0;">
                <template for:each={allScheduledCalls} for:item="call">
                  <li key={call.id} class="slds-item" style="padding: 0.25rem 0; border-bottom: 1px solid #e5e5e5;">
                    <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                      <div class="slds-col slds-size_9-of-12">
                        <div class="slds-text-body_small slds-m-bottom_none">
                          <strong>{call.candidateName}</strong> • {call.subject} • <span class="slds-text-color_weak">{call.formattedDate}</span>
                        </div>
                        <template if:true={call.description}>
                          <div class="slds-text-body_small slds-text-color_weak" style="font-size: 0.75rem;">{call.description}</div>
                        </template>
                      </div>
                      <div class="slds-col slds-size_3-of-12 slds-text-align_right">
                        <lightning-button 
                          variant="brand" 
                          label="Complete" 
                          size="small"
                          data-call-id={call.id}
                          onclick={handleCompleteCall}>
                        </lightning-button>
                      </div>
                    </div>
                  </li>
                </template>
              </ul>
            </template>
            <template if:false={allScheduledCalls.length}>
              <div class="slds-text-align_center slds-p-around_large">
                <lightning-icon icon-name="utility:success" size="large" class="slds-text-color_success"></lightning-icon>
                <p class="slds-text-heading_small slds-m-top_small">🎉 No Calls Scheduled</p>
                <p class="slds-text-body_regular slds-text-color_weak slds-m-top_x-small">You're all caught up! No scheduled calls at this time.</p>
              </div>
            </template>
          </template>
        </div>
        <footer class="slds-modal__footer" style="background-color: white;">
          <lightning-button 
            variant="neutral" 
            label="Close" 
            onclick={closeScheduledCallsModal}>
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- View All Past Due Calls Modal -->
  <template if:true={showAllPastDueCallsModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large">
      <div class="slds-modal__container" style="background-color: white;">
        <header class="slds-modal__header" style="background-color: white; padding-top: 0.5rem; padding-bottom: 0.5rem;">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick={closePastDueCallsModal}>
            <lightning-icon icon-name="utility:close" alternative-text="Close" size="small"></lightning-icon>
          </button>
          <h2 class="slds-text-heading_medium">All Past Due Calls ({allPastDueCalls.length})</h2>
        </header>
        <div class="slds-modal__content slds-p-around_small" style="background-color: white; padding-top: 0;">
          <template if:true={allPastDueCalls}>
            <template if:true={allPastDueCalls.length}>
              <ul class="slds-has-dividers_bottom-space" style="background-color: white; margin: 0; padding: 0;">
                <template for:each={allPastDueCalls} for:item="call">
                  <li key={call.id} class="slds-item" style="padding: 0.25rem 0; border-bottom: 1px solid #e5e5e5;">
                    <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                      <div class="slds-col slds-size_9-of-12">
                        <div class="slds-text-body_small slds-m-bottom_none">
                          <strong class="slds-text-color_error">{call.candidateName}</strong> • {call.subject} • <span class="slds-text-color_error">{call.formattedDate} • PAST DUE</span>
                        </div>
                        <template if:true={call.description}>
                          <div class="slds-text-body_small slds-text-color_weak" style="font-size: 0.75rem;">{call.description}</div>
                        </template>
                      </div>
                      <div class="slds-col slds-size_3-of-12 slds-text-align_right">
                        <lightning-button 
                          variant="destructive" 
                          label="Complete" 
                          size="small"
                          data-call-id={call.id}
                          onclick={handleCompleteCall}>
                        </lightning-button>
                      </div>
                    </div>
                  </li>
                </template>
              </ul>
            </template>
            <template if:false={allPastDueCalls.length}>
              <div class="slds-text-align_center slds-p-around_large">
                <lightning-icon icon-name="utility:success" size="large" class="slds-text-color_success"></lightning-icon>
                <p class="slds-text-heading_small slds-m-top_small">No past due calls</p>
              </div>
            </template>
          </template>
        </div>
        <footer class="slds-modal__footer" style="background-color: white;">
          <lightning-button 
            variant="neutral" 
            label="Close" 
            onclick={closePastDueCallsModal}>
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>

  <!-- Submit Feedback Modal (Bug Reports & Feature Requests) -->
  <template if:true={showFeedbackModal}>
    <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_medium feedback-modal">
      <div class="slds-modal__container" style="background-color: white;">
        <header class="slds-modal__header">
          <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick={closeFeedbackModal}>
            <lightning-icon icon-name="utility:close" alternative-text="Close" size="small"></lightning-icon>
          </button>
          <h2 class="slds-text-heading_medium">Submit Feedback</h2>
        </header>
        <div class="slds-modal__content slds-p-around_small" style="background-color: white; padding-top: 0;">
          <div class="slds-form" role="list">
            
            <!-- Submitted By -->
            <div class="slds-form-element slds-m-bottom_small">
              <label class="slds-form-element__label" for="submitted-by">
                <abbr class="slds-required" title="required">* </abbr>Submitted By
              </label>
              <div class="slds-form-element__control">
                <lightning-combobox
                  name="submittedBy"
                  value={feedbackSubmittedById}
                  placeholder="Select a user..."
                  options={feedbackUserOptions}
                  onchange={handleUserSelection}
                  required>
                </lightning-combobox>
              </div>
            </div>

            <!-- Feedback Type -->
            <div class="slds-form-element slds-m-bottom_small">
              <label class="slds-form-element__label" for="feedback-type">
                <abbr class="slds-required" title="required">* </abbr>Feedback Type
              </label>
              <div class="slds-form-element__control">
                <lightning-combobox
                  name="feedbackType"
                  value={feedbackType}
                  placeholder="Select feedback type"
                  options={feedbackTypeOptions}
                  onchange={handleFeedbackTypeChange}
                  required>
                </lightning-combobox>
              </div>
            </div>

            <!-- Priority (only for bugs) -->
            <template if:true={isBugReport}>
              <div class="slds-form-element slds-m-bottom_small">
                <label class="slds-form-element__label" for="priority">
                  <abbr class="slds-required" title="required">* </abbr>Priority
                </label>
                <div class="slds-form-element__control">
                  <lightning-combobox
                    name="priority"
                    value={feedbackPriority}
                    placeholder="Select priority"
                    options={priorityOptions}
                    onchange={handlePriorityChange}
                    required>
                  </lightning-combobox>
                </div>
              </div>
            </template>

            <!-- Subject -->
            <div class="slds-form-element slds-m-bottom_small">
              <label class="slds-form-element__label" for="subject">
                <abbr class="slds-required" title="required">* </abbr>Subject
              </label>
              <div class="slds-form-element__control">
                <lightning-input
                  name="subject"
                  value={feedbackSubject}
                  placeholder="Brief summary of your feedback"
                  onchange={handleSubjectChange}
                  required>
                </lightning-input>
              </div>
            </div>

            <!-- Description -->
            <div class="slds-form-element">
              <label class="slds-form-element__label" for="description">
                <abbr class="slds-required" title="required">* </abbr>Description
              </label>
              <div class="slds-form-element__control">
                <lightning-textarea
                  name="description"
                  value={feedbackDescription}
                  placeholder={feedbackPlaceholder}
                  onchange={handleDescriptionChange}
                  required>
                </lightning-textarea>
              </div>
            </div>

          </div>
        </div>
        <footer class="slds-modal__footer" style="background-color: white;">
          <lightning-button 
            variant="neutral" 
            label="Cancel" 
            onclick={closeFeedbackModal}>
          </lightning-button>
          <lightning-button 
            variant="brand" 
            label="Submit" 
            onclick={handleSubmitFeedback}
            disabled={isSubmitDisabled}>
          </lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>
</template>

